\hypertarget{a00675}{
\section{GSN Task Monitor (System Quality, SQ)}
\label{a00675}\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
}


This group contains system quality task monitoring related definitions.  


\subsection*{Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{a00675_gaad089e403699cbffe3ae8ccddc6a2fa2}{GSN\_\-SQ\_\-MAX\_\-TASKS}~32
\begin{DoxyCompactList}\small\item\em maximum number of tasks \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef enum \hyperlink{a00675_gabf7d0df05da1734b65c7831213712b38}{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID} \hyperlink{a00675_ga953706c798c40007d94a580180412cbc}{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-T}
\begin{DoxyCompactList}\small\item\em Task IDs. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{a00675_gabf7d0df05da1734b65c7831213712b38}{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID} \{ \par
\hyperlink{a00675_ggabf7d0df05da1734b65c7831213712b38a246f41404878a57d9ffd06087a7668de}{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-FIRST} =  0, 
\par
\hyperlink{a00675_ggabf7d0df05da1734b65c7831213712b38a67e6b7edb548bc21bf0a9b23f6bb3ece}{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-MAX}
 \}
\begin{DoxyCompactList}\small\item\em Task IDs. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
VOID \hyperlink{a00675_gad10ad5f9dbac0e77f484ca53319e52ad}{GsnSq\_\-Init} (VOID)
\begin{DoxyCompactList}\small\item\em System Quality Task Monitor initialization. \end{DoxyCompactList}\item 
PUBLIC VOID \hyperlink{a00675_gaf709cf6cb9df1be311084cdf383854a0}{GsnSq\_\-WdTmrStart} (VOID)
\begin{DoxyCompactList}\small\item\em System Quality Task Monitor timer start. \end{DoxyCompactList}\item 
VOID \hyperlink{a00675_gabfd6482b09418af5050000a0b7aff482}{GsnSq\_\-TaskMonitorRegister} (\hyperlink{a00660_gae1e6edbbc26d6fbc71a90190d0266018}{UINT32} taskId, \hyperlink{a00628_ga43c1eefe78fa26e478301976f96ac31f}{GSN\_\-OSAL\_\-THREAD\_\-TCB\_\-T} $\ast$thread, \hyperlink{a00660_gae1e6edbbc26d6fbc71a90190d0266018}{UINT32} monitorTime)
\begin{DoxyCompactList}\small\item\em Register monitor time for a given task ID. \end{DoxyCompactList}\item 
VOID \hyperlink{a00675_ga53008154a8350fc85d627cd563e4d1df}{GsnSq\_\-TaskMonitorDeregister} (\hyperlink{a00660_gae1e6edbbc26d6fbc71a90190d0266018}{UINT32} taskId)
\begin{DoxyCompactList}\small\item\em Deregister a task by setting max ticks to 0. \end{DoxyCompactList}\item 
VOID \hyperlink{a00675_ga96da464fdeb49f53790f74732ef808a9}{GsnSq\_\-TaskMonitorStart} (\hyperlink{a00660_gae1e6edbbc26d6fbc71a90190d0266018}{UINT32} taskId, \hyperlink{a00660_ga63021d67d54286c2163bcdb43a6f2569}{INT32} data)
\begin{DoxyCompactList}\small\item\em Start monitoring a given task by setting tick count to max+1. \end{DoxyCompactList}\item 
VOID \hyperlink{a00675_ga285d40bdd1cfff28b38cc49232859568}{GsnSq\_\-TaskMonitorStop} (\hyperlink{a00660_gae1e6edbbc26d6fbc71a90190d0266018}{UINT32} taskId)
\begin{DoxyCompactList}\small\item\em Stop monitoring a given task by setting tick count to INVALID. \end{DoxyCompactList}\item 
VOID \hyperlink{a00675_ga8f76a4cc1c863a3ca744e3c377f3a4bd}{GsnSq\_\-AssertHandler} (\hyperlink{a00660_gab27e9918b538ce9d8ca692479b375b6a}{UINT8} level)
\begin{DoxyCompactList}\small\item\em Handle Assert based on the level. \end{DoxyCompactList}\item 
VOID \hyperlink{a00675_ga14affd26fb768070a8d90706441b8c8d}{GsnSq\_\-DeInit} (VOID)
\begin{DoxyCompactList}\small\item\em Sysqual Deinit. \end{DoxyCompactList}\item 
\hyperlink{a00660_ga1f04022c0a182c51c059438790ea138c}{BOOL} \hyperlink{a00675_gac34869e67e126c75fd2f750c34fe1789}{GsnSq\_\-TaskMonitorStarted} (VOID)
\begin{DoxyCompactList}\small\item\em Returns TRUE if monitor started. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
This group contains system quality task monitoring related definitions. The System Quality Task Monitoring (SQ) module registers its handler with the interrupt module, so that it receives interrupts generated by the Watchdog when the half-\/period is reached. The Task Monitoring module tracks the execution time of tasks that have registered with it. When any task exceeds the stipulated maximum time, the System Quality module issues a software reset to ensure recovery from a hung condition. \par
 \par
 The Task Monitoring group provides API functions for starting and ending monitoring of a given task, and for establishing the maximum allowed execution time. Invariably a task is one of the two states:
\begin{DoxyItemize}
\item IDLE : Waiting ( blocking on a semaphore or message queue) for one or more events to occur
\item RUNNING: Processing the event \par

\end{DoxyItemize}

The purpose of the Task Monitor is to catch any application that is stuck in the running state (either executing instructions in a loop or waiting indefinitely on resources due to deadlocks), and ensure that any operations are completed within the maximum time allowed when that task registered with the Monitor. A pseudocode formulation of the problem might be: \begin{DoxyVerb}
 *   while (1) {
 *             Stop Monitoring This Task.
 *             Wait for some event.	  	: IDLE - Task Monitor not active.
 *             Start Monitoring This Task.	: RUNNING - Watchdog Monitor active.
 *             (task running)			: task execution time.
 *             }
 *  \end{DoxyVerb}


To make this possible, the System Quality Task Monitoring module needs to know what activity periods are reasonable for any task. This is accomplished by having each task register with the SQ module. Tasks call GsnSq\_\-TaskMonitorRegister(taskId, monitorTime) to register the maximum turn-\/around of their event processing state in terms of seconds. Each task is identified by an index taskId, which can take a value from GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-MAX to 31. (\mbox{[}GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-MAX-\/1\mbox{]} is the last index used by GEPS itself.) The User Application is responsible for managing the assignment of these index values to the various tasks it creates. \par
 \par
 The SQ module keeps time in terms of Watchdog interrupts, so the requested maximum time in seconds, monitorTime, is converted to units of half-\/intervals of the Watchdog timer expiration period (section 5.1), obtained by reading the divisor value. For example, if the Watchdog timer expires in its maximum time of (about) 16 seconds, the interrupt time unit is 8 seconds. A task request for a maximum run time of 30 seconds is converted into (30/8) = 3 Watchdog interrupt times. (Note that, as a consequence, the resolution of the measurement depends on the Watchdog divisor used in the call to GsnSysCtl\_\-WdEnable().) The SQ module maintains a per-\/task monitor list. This per-\/task list provides the detailed information required to decide whether the task is stuck. The monitor also maintains a free running (monotonically increasing) count of Watchdog Interrupts. GsnSq\_\-TaskMonitorEnd() sets the taskTickCount for a task to SQ\_\-TICK\_\-COUNT\_\-INVALID to indicate that the task is IDLE. \hyperlink{a00675_ga96da464fdeb49f53790f74732ef808a9}{GsnSq\_\-TaskMonitorStart()} sets the taskTickCount to (maximum allowed ticks+1), to record the moment when the task moved to the RUNNING state. Each time a watchdog interrupt is received, the Task Monitor decrements the counter for the tasks in the running state and checks to see if the task activity period has been exceeded without taskTickCount having been reset to SQ\_\-TICK\_\-COUNT\_\-INVALID. (That is, a task has run for longer than the activity period without calling GsnSq\_\-TaskMonitorEnd().) If this occurs, the Task Monitor considers the task to be hung and issues a software reset. 

\subsection{Define Documentation}
\hypertarget{a00675_gaad089e403699cbffe3ae8ccddc6a2fa2}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GSN\_\-SQ\_\-MAX\_\-TASKS@{GSN\_\-SQ\_\-MAX\_\-TASKS}}
\index{GSN\_\-SQ\_\-MAX\_\-TASKS@{GSN\_\-SQ\_\-MAX\_\-TASKS}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GSN\_\-SQ\_\-MAX\_\-TASKS}]{\setlength{\rightskip}{0pt plus 5cm}\#define GSN\_\-SQ\_\-MAX\_\-TASKS~32}}
\label{a00675_gaad089e403699cbffe3ae8ccddc6a2fa2}


maximum number of tasks 



Definition at line 141 of file gsn\_\-sys\_\-qual.h.



\subsection{Typedef Documentation}
\hypertarget{a00675_ga953706c798c40007d94a580180412cbc}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-T@{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-T}}
\index{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-T@{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-T}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-T}]{\setlength{\rightskip}{0pt plus 5cm}typedef enum {\bf GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID}  {\bf GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-T}}}
\label{a00675_ga953706c798c40007d94a580180412cbc}


Task IDs. 

This enum defines the task IDs that need to be monitored by system quality task monitoring. 

\subsection{Enumeration Type Documentation}
\hypertarget{a00675_gabf7d0df05da1734b65c7831213712b38}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID@{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID}}
\index{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID@{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID}}}
\label{a00675_gabf7d0df05da1734b65c7831213712b38}


Task IDs. 

This enum defines the task IDs that need to be monitored by system quality task monitoring. \begin{Desc}
\item[Enumerator: ]\par
\begin{description}
\index{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-FIRST@{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-FIRST}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-FIRST@{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-FIRST}}\item[{\em 
\hypertarget{a00675_ggabf7d0df05da1734b65c7831213712b38a246f41404878a57d9ffd06087a7668de}{
GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-FIRST}
\label{a00675_ggabf7d0df05da1734b65c7831213712b38a246f41404878a57d9ffd06087a7668de}
}]\index{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-MAX@{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-MAX}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-MAX@{GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-MAX}}\item[{\em 
\hypertarget{a00675_ggabf7d0df05da1734b65c7831213712b38a67e6b7edb548bc21bf0a9b23f6bb3ece}{
GSN\_\-SQ\_\-TASK\_\-MONITOR\_\-ID\_\-MAX}
\label{a00675_ggabf7d0df05da1734b65c7831213712b38a67e6b7edb548bc21bf0a9b23f6bb3ece}
}]\end{description}
\end{Desc}



Definition at line 157 of file gsn\_\-sys\_\-qual.h.



\subsection{Function Documentation}
\hypertarget{a00675_ga8f76a4cc1c863a3ca744e3c377f3a4bd}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GsnSq\_\-AssertHandler@{GsnSq\_\-AssertHandler}}
\index{GsnSq\_\-AssertHandler@{GsnSq\_\-AssertHandler}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GsnSq\_\-AssertHandler}]{\setlength{\rightskip}{0pt plus 5cm}VOID GsnSq\_\-AssertHandler (
\begin{DoxyParamCaption}
\item[{{\bf UINT8}}]{level}
\end{DoxyParamCaption}
)}}
\label{a00675_ga8f76a4cc1c863a3ca744e3c377f3a4bd}


Handle Assert based on the level. 


\begin{DoxyParams}{Parameters}
{\em level} & -\/ IN Level of the assert \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\hypertarget{a00675_ga14affd26fb768070a8d90706441b8c8d}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GsnSq\_\-DeInit@{GsnSq\_\-DeInit}}
\index{GsnSq\_\-DeInit@{GsnSq\_\-DeInit}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GsnSq\_\-DeInit}]{\setlength{\rightskip}{0pt plus 5cm}VOID GsnSq\_\-DeInit (
\begin{DoxyParamCaption}
\item[{VOID}]{}
\end{DoxyParamCaption}
)}}
\label{a00675_ga14affd26fb768070a8d90706441b8c8d}


Sysqual Deinit. 

\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\hypertarget{a00675_gad10ad5f9dbac0e77f484ca53319e52ad}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GsnSq\_\-Init@{GsnSq\_\-Init}}
\index{GsnSq\_\-Init@{GsnSq\_\-Init}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GsnSq\_\-Init}]{\setlength{\rightskip}{0pt plus 5cm}VOID GsnSq\_\-Init (
\begin{DoxyParamCaption}
\item[{VOID}]{}
\end{DoxyParamCaption}
)}}
\label{a00675_gad10ad5f9dbac0e77f484ca53319e52ad}


System Quality Task Monitor initialization. 

\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\hypertarget{a00675_ga53008154a8350fc85d627cd563e4d1df}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GsnSq\_\-TaskMonitorDeregister@{GsnSq\_\-TaskMonitorDeregister}}
\index{GsnSq\_\-TaskMonitorDeregister@{GsnSq\_\-TaskMonitorDeregister}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GsnSq\_\-TaskMonitorDeregister}]{\setlength{\rightskip}{0pt plus 5cm}VOID GsnSq\_\-TaskMonitorDeregister (
\begin{DoxyParamCaption}
\item[{{\bf UINT32}}]{taskId}
\end{DoxyParamCaption}
)}}
\label{a00675_ga53008154a8350fc85d627cd563e4d1df}


Deregister a task by setting max ticks to 0. 


\begin{DoxyParams}{Parameters}
{\em taskId} & -\/ IN unique task identifier \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\hypertarget{a00675_gabfd6482b09418af5050000a0b7aff482}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GsnSq\_\-TaskMonitorRegister@{GsnSq\_\-TaskMonitorRegister}}
\index{GsnSq\_\-TaskMonitorRegister@{GsnSq\_\-TaskMonitorRegister}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GsnSq\_\-TaskMonitorRegister}]{\setlength{\rightskip}{0pt plus 5cm}VOID GsnSq\_\-TaskMonitorRegister (
\begin{DoxyParamCaption}
\item[{{\bf UINT32}}]{taskId, }
\item[{{\bf GSN\_\-OSAL\_\-THREAD\_\-TCB\_\-T} $\ast$}]{thread, }
\item[{{\bf UINT32}}]{monitorTime}
\end{DoxyParamCaption}
)}}
\label{a00675_gabfd6482b09418af5050000a0b7aff482}


Register monitor time for a given task ID. 


\begin{DoxyParams}{Parameters}
{\em taskId} & -\/ IN unique task identifier \\
\hline
{\em thread} & -\/ IN pointer to the TCB \\
\hline
{\em monitorTime} & -\/ IN time allotted \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\hypertarget{a00675_ga96da464fdeb49f53790f74732ef808a9}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GsnSq\_\-TaskMonitorStart@{GsnSq\_\-TaskMonitorStart}}
\index{GsnSq\_\-TaskMonitorStart@{GsnSq\_\-TaskMonitorStart}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GsnSq\_\-TaskMonitorStart}]{\setlength{\rightskip}{0pt plus 5cm}VOID GsnSq\_\-TaskMonitorStart (
\begin{DoxyParamCaption}
\item[{{\bf UINT32}}]{taskId, }
\item[{{\bf INT32}}]{data}
\end{DoxyParamCaption}
)}}
\label{a00675_ga96da464fdeb49f53790f74732ef808a9}


Start monitoring a given task by setting tick count to max+1. 


\begin{DoxyParams}{Parameters}
{\em taskId} & -\/ IN unique task identifier \\
\hline
{\em data} & -\/ IN value for data field of task monitor structure. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\hypertarget{a00675_gac34869e67e126c75fd2f750c34fe1789}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GsnSq\_\-TaskMonitorStarted@{GsnSq\_\-TaskMonitorStarted}}
\index{GsnSq\_\-TaskMonitorStarted@{GsnSq\_\-TaskMonitorStarted}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GsnSq\_\-TaskMonitorStarted}]{\setlength{\rightskip}{0pt plus 5cm}{\bf BOOL} GsnSq\_\-TaskMonitorStarted (
\begin{DoxyParamCaption}
\item[{VOID}]{}
\end{DoxyParamCaption}
)}}
\label{a00675_gac34869e67e126c75fd2f750c34fe1789}


Returns TRUE if monitor started. 

\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\hypertarget{a00675_ga285d40bdd1cfff28b38cc49232859568}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GsnSq\_\-TaskMonitorStop@{GsnSq\_\-TaskMonitorStop}}
\index{GsnSq\_\-TaskMonitorStop@{GsnSq\_\-TaskMonitorStop}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GsnSq\_\-TaskMonitorStop}]{\setlength{\rightskip}{0pt plus 5cm}VOID GsnSq\_\-TaskMonitorStop (
\begin{DoxyParamCaption}
\item[{{\bf UINT32}}]{taskId}
\end{DoxyParamCaption}
)}}
\label{a00675_ga285d40bdd1cfff28b38cc49232859568}


Stop monitoring a given task by setting tick count to INVALID. 


\begin{DoxyParams}{Parameters}
{\em taskId} & -\/ IN unique task identifier \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\hypertarget{a00675_gaf709cf6cb9df1be311084cdf383854a0}{
\index{GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}!GsnSq\_\-WdTmrStart@{GsnSq\_\-WdTmrStart}}
\index{GsnSq\_\-WdTmrStart@{GsnSq\_\-WdTmrStart}!GSN Task Monitor (System Quality, SQ)@{GSN Task Monitor (System Quality, SQ)}}
\subsubsection[{GsnSq\_\-WdTmrStart}]{\setlength{\rightskip}{0pt plus 5cm}PUBLIC VOID GsnSq\_\-WdTmrStart (
\begin{DoxyParamCaption}
\item[{VOID}]{}
\end{DoxyParamCaption}
)}}
\label{a00675_gaf709cf6cb9df1be311084cdf383854a0}


System Quality Task Monitor timer start. 

\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
